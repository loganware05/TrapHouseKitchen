# Environment Variables Guide

This document lists all environment variables needed for deployment.

---

## Quick Reference

### Backend API (.env)

```bash
# Database
DATABASE_URL=postgresql://user:password@host:5432/database

# JWT Authentication
JWT_SECRET=your-super-secret-jwt-key-min-32-chars
JWT_EXPIRES_IN=7d

# API Configuration
PORT=3001
NODE_ENV=production
FRONTEND_URL=https://your-frontend-url.com

# Stripe Payment
STRIPE_SECRET_KEY=sk_live_YOUR_SECRET_KEY
STRIPE_PUBLISHABLE_KEY=pk_live_YOUR_PUBLISHABLE_KEY

# Email Service (Optional)
RESEND_API_KEY=re_YOUR_API_KEY
FROM_EMAIL=TrapHouse Kitchen <orders@yourdomain.com>
CHEF_EMAIL=chef@yourdomain.com
```

### Frontend (.env)

```bash
# API Endpoint
VITE_API_URL=https://your-backend-url.com/api

# Stripe Payment
VITE_STRIPE_PUBLISHABLE_KEY=pk_live_YOUR_PUBLISHABLE_KEY
```

---

## Detailed Variable Descriptions

### Backend Variables

#### DATABASE_URL (Required)
- **Description:** PostgreSQL connection string
- **Format:** `postgresql://username:password@host:port/database`
- **Render:** Auto-configured when using Render PostgreSQL
- **Example:** `postgresql://traphouse:password@db-hostname.render.com:5432/traphouse_kitchen`

#### JWT_SECRET (Required)
- **Description:** Secret key for signing JWT tokens
- **Security:** Must be at least 32 characters, random and secure
- **Render:** Can be auto-generated by Render
- **Generate:** `openssl rand -base64 32`

#### JWT_EXPIRES_IN (Optional)
- **Description:** JWT token expiration time
- **Default:** `7d` (7 days)
- **Options:** `1h`, `24h`, `7d`, `30d`
- **Production:** Recommended `7d` for good UX

#### PORT (Required)
- **Description:** Port for backend server
- **Default:** `3001`
- **Render:** Often auto-set to `10000`

#### NODE_ENV (Required)
- **Description:** Application environment
- **Options:** `development`, `production`
- **Render:** Auto-set to `production`

#### FRONTEND_URL (Required)
- **Description:** Frontend URL for CORS configuration
- **Development:** `http://localhost:5173`
- **Production:** `https://your-frontend-domain.com`
- **Render:** Auto-configured from frontend service

#### STRIPE_SECRET_KEY (Required)
- **Description:** Stripe API secret key
- **Get From:** [dashboard.stripe.com/apikeys](https://dashboard.stripe.com/apikeys)
- **Test Mode:** `sk_test_...`
- **Live Mode:** `sk_live_...`
- **Security:** ⚠️ NEVER commit this to git!

#### STRIPE_PUBLISHABLE_KEY (Required)
- **Description:** Stripe API publishable key
- **Get From:** [dashboard.stripe.com/apikeys](https://dashboard.stripe.com/apikeys)
- **Test Mode:** `pk_test_...`
- **Live Mode:** `pk_live_...`
- **Note:** Safe to expose to frontend

#### RESEND_API_KEY (Optional)
- **Description:** Resend email service API key
- **Get From:** [resend.com/api-keys](https://resend.com/api-keys)
- **Format:** `re_...`
- **Free Tier:** 3,000 emails/month
- **Required For:** Order confirmation emails

#### FROM_EMAIL (Optional)
- **Description:** Email address for outgoing emails
- **Format:** `Restaurant Name <email@domain.com>`
- **Example:** `TrapHouse Kitchen <orders@traphousekitchen.com>`
- **Resend:** Must verify domain or use provided address

#### CHEF_EMAIL (Optional)
- **Description:** Email to notify when new orders arrive
- **Format:** `chef@yourdomain.com`
- **Example:** `manager@traphousekitchen.com`

---

### Frontend Variables

#### VITE_API_URL (Required)
- **Description:** Backend API base URL
- **Development:** `http://localhost:3001/api`
- **Production:** `https://your-backend.onrender.com/api`
- **Note:** Must include `/api` at the end
- **Render:** Auto-configured from backend service

#### VITE_STRIPE_PUBLISHABLE_KEY (Required)
- **Description:** Stripe publishable key (same as backend)
- **Get From:** [dashboard.stripe.com/apikeys](https://dashboard.stripe.com/apikeys)
- **Test Mode:** `pk_test_...`
- **Live Mode:** `pk_live_...`
- **Note:** Prefixed with `VITE_` for Vite to include in build

---

## Render Configuration

### Auto-Configured Variables

Render automatically configures:
- `DATABASE_URL` - From PostgreSQL service
- `FRONTEND_URL` - From frontend service URL
- `VITE_API_URL` - From backend service URL
- `NODE_ENV` - Set to `production`
- `JWT_SECRET` - Can be auto-generated

### Manually Set Variables

You must manually set:
- All Stripe keys
- Email service keys
- Custom configuration

### Setting Variables in Render

1. Go to service (e.g., `traphousekitchen-api`)
2. Click "Environment" tab
3. Click "Add Environment Variable"
4. Enter key and value
5. Click "Save Changes"
6. Service will redeploy automatically

---

## Development vs Production

### Development (Local)

**Backend `.env`:**
```bash
DATABASE_URL=postgresql://traphouse:traphouse_dev_password@localhost:5432/traphouse_kitchen
JWT_SECRET=dev-secret-key-minimum-32-characters-long
JWT_EXPIRES_IN=7d
PORT=3001
NODE_ENV=development
FRONTEND_URL=http://localhost:5173

# Test Stripe Keys
STRIPE_SECRET_KEY=sk_test_51...
STRIPE_PUBLISHABLE_KEY=pk_test_51...

# Optional
RESEND_API_KEY=re_...
FROM_EMAIL=TrapHouse Kitchen <onboarding@resend.dev>
CHEF_EMAIL=test@example.com
```

**Frontend `.env`:**
```bash
VITE_API_URL=http://localhost:3001/api
VITE_STRIPE_PUBLISHABLE_KEY=pk_test_51...
```

### Production (Render)

**Backend Environment Variables:**
```bash
DATABASE_URL=postgresql://... (auto-configured)
JWT_SECRET=... (auto-generated or manual)
JWT_EXPIRES_IN=7d
PORT=10000 (auto-configured)
NODE_ENV=production (auto-configured)
FRONTEND_URL=https://traphousekitchen-web.onrender.com (auto-configured)

# Live Stripe Keys
STRIPE_SECRET_KEY=sk_live_51...
STRIPE_PUBLISHABLE_KEY=pk_live_51...

# Production Email
RESEND_API_KEY=re_...
FROM_EMAIL=TrapHouse Kitchen <orders@traphousekitchen.com>
CHEF_EMAIL=chef@traphousekitchen.com
```

**Frontend Environment Variables:**
```bash
VITE_API_URL=https://traphousekitchen-api.onrender.com/api (auto-configured)
VITE_STRIPE_PUBLISHABLE_KEY=pk_live_51...
```

---

## Security Best Practices

### DO:
- ✅ Use strong, random `JWT_SECRET` (min 32 chars)
- ✅ Keep `.env` files in `.gitignore`
- ✅ Use different keys for development and production
- ✅ Rotate secrets periodically
- ✅ Use Stripe test keys during development
- ✅ Set `NODE_ENV=production` in production

### DON'T:
- ❌ Commit `.env` files to git
- ❌ Share secret keys publicly
- ❌ Use production keys in development
- ❌ Hardcode secrets in source code
- ❌ Use weak JWT secrets
- ❌ Expose backend URLs unnecessarily

---

## Generating Secure Values

### JWT_SECRET
```bash
# macOS/Linux
openssl rand -base64 32

# Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

### Stripe Keys
1. Go to [dashboard.stripe.com](https://dashboard.stripe.com)
2. Developers → API keys
3. Copy "Publishable key" and "Secret key"
4. Toggle test/live mode as needed

### Resend API Key
1. Go to [resend.com](https://resend.com)
2. Sign up/login
3. API Keys → Create API Key
4. Copy key (starts with `re_`)

---

## Troubleshooting

### "JWT_SECRET is not defined"
- Ensure variable is set in Render environment
- Check variable name spelling (case-sensitive)
- Verify service redeployed after adding variable

### "Failed to connect to database"
- Check `DATABASE_URL` format
- Ensure PostgreSQL service is running
- Verify database exists

### "CORS error" from frontend
- Check `FRONTEND_URL` in backend
- Ensure URL doesn't have trailing slash
- Verify frontend URL is correct

### "Stripe key invalid"
- Verify you're using correct key (test vs live)
- Check for extra spaces or line breaks
- Ensure key matches Stripe dashboard

### "Email not sending"
- Check `RESEND_API_KEY` is set
- Verify email domain is verified in Resend
- Check backend logs for errors

---

## Additional Resources

- **Stripe API Keys:** [stripe.com/docs/keys](https://stripe.com/docs/keys)
- **Resend Setup:** [resend.com/docs](https://resend.com/docs)
- **Render Environment:** [render.com/docs/environment-variables](https://render.com/docs/environment-variables)
- **PostgreSQL Connection:** [render.com/docs/databases](https://render.com/docs/databases)
